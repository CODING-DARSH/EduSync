{% extends "base.html" %}
{% block title %}Student Dashboard{% endblock %}
{% block content %}

<!-- Tailwind + Chart.js -->
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  :root{
    --bg: #05040a;
    --card: #0b0b0f;
    --muted: #9aa5b1;
    --primary: #6366f1;
    --accent: #8b5cf6;
    --glass-1: rgba(255,255,255,0.03);
    --glass-2: rgba(255,255,255,0.02);
    --blur: 10px;
  }

  html,body {
    background: linear-gradient(180deg,#040407 0%, #07060a 100%);
    color: #e6eef8;
    font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    min-height: 100vh;
  }

  /* Base glass card */
  .glass {
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.12));
    border: 1px solid var(--glass-1);
    backdrop-filter: blur(var(--blur));
    border-radius: 12px;
  }

  .glass-soft {
    background: rgba(11,12,14,0.6);
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.03);
  }

  .muted { color: var(--muted); }
  .text-gradient {
    background: linear-gradient(90deg,var(--primary),var(--accent));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  /* Buttons */
  .btn-grad {
    background: linear-gradient(90deg,var(--primary),var(--accent));
    color: white;
    padding: 4px 8px;
    border-radius: 10px;
    font-weight: 600;
    box-shadow: 0 8px 30px rgba(99,102,241,0.14);
  }

  .btn-subtle {
    background: rgba(255,255,255,0.02);
    border: 1px solid rgba(255,255,255,0.03);
    padding: 8px 10px;
    border-radius: 10px;
    color: #dbeafe;
  }

  /* Small badges */
  .badge {
    padding: 4px 8px;
    border-radius: 999px;
    font-size: 0.72rem;
    font-weight: 700;
  }
  .badge-due { background: rgba(239,68,68,0.12); color:#fca5a5; }
  .badge-sub { background: rgba(59,130,246,0.08); color:#bfdbfe; }
  .badge-graded { background: rgba(16,185,129,0.08); color:#bbf7d0; }

  /* Header search */
  .search {
    background: rgba(255,255,255,0.02);
    border: 1px solid rgba(255,255,255,0.03);
    color: #dbeafe;
    padding: 8px 12px;
    border-radius: 10px;
    width: 360px;
  }

  /* Table */
  table thead th { color: var(--muted); font-weight: 600; font-size: 0.85rem; text-align: left; padding: 12px; }
  table tbody td { padding: 12px; border-top: 1px solid rgba(255,255,255,0.02); vertical-align: middle; color: #dbeafe; }

  /* Sidebar width */
  .sidebar {
    width: 300px;
    min-width: 240px;
  }

  /* Collapsible assignments */
  #assignBody {
    transition: max-height 320ms cubic-bezier(.2,.9,.2,1), padding 220ms ease;
    overflow: hidden;
  }

  /* Scrollbars */
  .custom-scroll::-webkit-scrollbar { width: 8px; }
  .custom-scroll::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.05); border-radius: 8px; }

  /* subtle lift */
  .lift { transition: transform .18s ease, box-shadow .18s ease, opacity .18s ease; }
  .lift:hover { transform: translateY(-6px); box-shadow: 0 14px 40px rgba(0,0,0,0.55); }

  @media (max-width: 1024px){
    .search { width: 200px; }
    .sidebar { width: 100%; min-width: 0; }
    .layout { flex-direction: column; gap: 12px; }
  }
</style>

<!-- main container -->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">

  <!-- NAVBAR (top) -->
  <header class="fixed left-4 right-4 top-4 z-50">
    <div class="glass flex items-center justify-between px-4 py-3">
      <!-- brand -->
      <div class="flex items-center gap-3">
        <div class="w-11 h-11 rounded-lg flex items-center justify-center"
             style="background: linear-gradient(135deg,var(--primary),var(--accent)); box-shadow: 0 8px 30px rgba(99,102,241,0.14);">
          <span class="font-bold text-white">E</span>
        </div>
        <div>
          <div class="text-sm font-semibold text-gradient">EduSync</div>
          <div class="text-xs muted -mt-0.5">Student Portal</div>
        </div>
      </div>

      <!-- search + buttons -->
      <div class="flex items-center gap-3">
        <input id="globalSearch" class="search" placeholder="Search courses, assignments, notifications..." />

        <button class="btn-subtle p-2 rounded-lg relative" title="Notifications">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#cbd5e1" stroke-width="1.6">
            <path d="M15 17H9" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M18 8a6 6 0 10-12 0v5L4 16v1h16v-1l-2-3V8z" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          {% if notifications %}
          <span class="absolute -mt-3 ml-5 inline-block w-2.5 h-2.5 rounded-full bg-red-500"></span>
          {% endif %}
        </button>

        <form action="/logout" method="POST" class="m-0">
<button class="px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2
  hover:bg-white/20 transition text-gray-200">
  <span>üö™</span> Logout
</button>


        </form>
      </div>
    </div>
  </header>

  <!-- spacer for fixed header -->
  <div class="h-20"></div>

  <!-- layout: sidebar + main -->
  <div class="layout flex gap-6">

    <!-- SIDEBAR (classic) -->
    <aside class="sidebar flex-shrink-0 space-y-6">

      <div class="glass-soft p-5 lift min-h-[160px]">
        <div class="flex flex-col items-center text-center gap-3">
          <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="avatar" class="w-20 h-20 rounded-full border border-white/6">
          <div>
            <div class="text-lg font-semibold">{{ student[1] }}</div>
            <div class="text-xs muted mt-0.5">ID: {{ student[8] }}</div>
            <div class="text-xs muted">{{ student[2] or 'Not Assigned' }}</div>
          </div>
          <div class="w-full bg-white/6 rounded-full h-1.5 mt-2">
            <div class="rounded-full h-1.5" style="width:75%; background: linear-gradient(90deg,var(--primary),var(--accent));"></div>
          </div>
        </div>
      </div>

      <nav class="glass p-4 lift">
        <ul class="space-y-2">
          <li><a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/4 transition-colors" href="#"><span>üè†</span><span class="font-medium">Dashboard</span></a></li>
          <li><a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/4 transition-colors" href="#"><span>üìö</span><span class="font-medium">Courses</span></a></li>
          <li><a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/4 transition-colors" href="#"><span>üìÇ</span><span class="font-medium">Assignments</span></a></li>
          <li><a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/4 transition-colors" href="#"><span>üí¨</span><span class="font-medium">Discussions</span></a></li>
          <li><a class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/4 transition-colors" href="#"><span>‚öôÔ∏è</span><span class="font-medium">Settings</span></a></li>
        </ul>
      </nav>

      <div class="glass-soft p-4 lift">
        <h4 class="text-sm font-semibold mb-2">üìù Enroll</h4>
        <form method="POST" action="/student/enroll" class="space-y-3">
          <input name="course_id" required placeholder="Course ID (e.g., CS101)"
                 class="w-full bg-transparent border border-white/6 rounded-lg px-3 py-2 text-white focus:outline-none" />
          <button class="btn-grad w-full" type="submit">Enroll Now</button>
        </form>
      </div>

      <div class="glass-soft p-4 lift">
        <h4 class="text-sm font-semibold mb-2">‚ö° Quick Actions</h4>
        <div class="grid gap-2">
          <button class="btn-subtle w-full text-left px-3 py-2 rounded-lg">üìö View Course Materials</button>
          <button class="btn-subtle w-full text-left px-3 py-2 rounded-lg">üìÖ Academic Calendar</button>
          <button class="btn-subtle w-full text-left px-3 py-2 rounded-lg">üí¨ Class Discussions</button>
        </div>
      </div>

      <div class="glass-soft p-3 text-center muted text-xs">
        EduSync ‚Ä¢ Lightweight LMS UI
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 space-y-6">

      <!-- HERO -->
      <section class="glass p-6 lift">
        <div class="flex flex-col lg:flex-row items-center justify-between gap-6">
          <div>
            <h1 class="text-2xl font-bold">Welcome back, <span class="text-gradient">{{ student[1] }}</span> üëã</h1>
            <p class="muted mt-1">Your learning at a glance ‚Äî stay focused, stay consistent.</p>

            <div class="flex flex-wrap gap-3 mt-4">
              <div class="glass-soft px-4 py-3 rounded-lg flex items-center gap-4">
                <div class="text-sm muted">Courses</div>
                <div class="text-lg font-bold">{{ courses|length if courses else 0 }}</div>
              </div>

              <div class="glass-soft px-4 py-3 rounded-lg flex items-center gap-4">
                <div class="text-sm muted">Pending</div>
                <div class="text-lg font-bold text-yellow-300">{{ assignments|selectattr('3','eq',None)|list|length if assignments else 0 }}</div>
              </div>

              <div class="glass-soft px-4 py-3 rounded-lg flex items-center gap-4">
                <div class="text-sm muted">Notifications</div>
                <div class="text-lg font-bold text-blue-300">{{ notifications|length if notifications else 0 }}</div>
              </div>
            </div>
          </div>

          <div class="flex items-center gap-4">
            <div class="w-16 h-16 rounded-full flex items-center justify-center"
                 style="background: linear-gradient(135deg,var(--primary),var(--accent)); box-shadow: 0 10px 30px rgba(99,102,241,0.12);">
              <span style="font-size:22px">üéì</span>
            </div>
            <div class="text-right">
              <div class="muted text-sm">Academic Progress</div>
              <div class="font-semibold">Keep pushing ‚Äî small wins daily.</div>
            </div>
          </div>
        </div>
      </section>

      <!-- COURSES -->
      <section class="glass p-5 lift">
        <div class="flex justify-between items-center mb-4">
          <h3 class="font-semibold">üìö My Courses</h3>
          <div class="muted text-sm">{{ courses|length }} enrolled</div>
        </div>

        {% if courses %}
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          {% for c in courses %}
          <div class="glass-soft p-3 rounded-lg">
            <div class="flex justify-between items-center">
              <div class="font-semibold text-white">{{ c }}</div>
              <div class="badge badge-sub">Active</div>
            </div>
            <div class="w-full bg-white/6 rounded-full h-1.5 mt-3">
              <div class="rounded-full h-1.5" style="width:85%; background: linear-gradient(90deg,var(--primary),var(--accent));"></div>
            </div>
            <div class="flex justify-between text-xs muted mt-2">
              <span>Progress</span>
              <span>85%</span>
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <div class="text-center muted py-6">No enrolled courses yet.</div>
        {% endif %}
      </section>

      <!-- ASSIGNMENTS (single collapsible section) -->
      <section class="glass p-0 lift">
        <div class="p-4 flex items-center justify-between">
          <div>
            <h3 class="font-semibold">üìÇ Assignments</h3>
            <div class="muted text-sm mt-0.5">{{ assignments|length }} total</div>
          </div>

          <div>
            <button id="assignToggle" class="btn-subtle flex items-center gap-2" aria-expanded="false" aria-controls="assignBody">
              <svg id="assignIcon" width="16" height="16" viewBox="0 0 24 24" fill="none"><path d="M6 9l6 6 6-6" stroke="#e6eef8" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/></svg>
              <span class="text-sm">Show Assignments</span>
            </button>
          </div>
        </div>

        <div id="assignBody" class="max-h-0 px-4" aria-hidden="true">
          <div class="py-4">
            {% if assignments %}
            <div class="overflow-x-auto overflow-visible custom-scroll rounded-lg">
              <table class="w-full">
                <thead class="bg-white/3 rounded-t-lg">
                  <tr>
                    <th>Assignment</th>
                    <th>Due Date</th>
                    <th>Status</th>
                    <th>Score / Action</th>
                  </tr>
                </thead>
                <tbody>
                  {% for a in assignments %}
                  <tr>
                    <td class="font-medium">{{ a[1] }}</td>
                    <td class="muted">{{ a[2] }}</td>
                    <td>
                      {% if a[3] %}
                        {% if a[4] %}
                          <span class="badge badge-graded">Graded</span>
                        {% else %}
                          <span class="badge badge-sub">Submitted</span>
                        {% endif %}
                      {% else %}
                        <span class="badge badge-due">Due</span>
                      {% endif %}
                    </td>
                    <td style="display:flex; align-items:center; gap:10px; overflow:visible;">
          <form method="POST" action="/student/upload" enctype="multipart/form-data" class="flex items-center gap-2">
  <input type="hidden" name="assignment_id" value="{{ a[0] }}">
  <input type="file" name="file" class="text-xs px-2 py-1 rounded bg-white/3" />

  {% if a[4] %}
    <button type="submit" class="btn-grad text-xs">Re-submit</button>
    <span class="font-semibold text-green-300">{{ a[4] }}/100</span>

  {% else %}
    <button type="submit" class="btn-grad text-xs">Submit</button>

  {% endif %}
</form>

                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            {% else %}
            <div class="text-center muted py-6">No assignments available.</div>
            {% endif %}
          </div>
        </div>
      </section>

      <!-- PERFORMANCE + UPCOMING -->
      <section class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="glass p-4 lift">
          <h4 class="font-semibold mb-3">üìä Performance</h4>
          <div class="h-44">
            <canvas id="gradeChart"></canvas>
          </div>
        </div>

        <div class="glass p-4 lift">
          <h4 class="font-semibold mb-3">‚è∞ Upcoming</h4>
          <div class="space-y-3">
            {% set upcoming = assignments|selectattr('3','eq',None)|list %}
            {% if upcoming and upcoming|length > 0 %}
              {% for a in upcoming %}
              <div class="glass-soft p-3 rounded-lg flex items-center justify-between">
                <div>
                  <div class="font-medium">{{ a[1] }}</div>
                  <div class="text-xs muted">{{ a[2] }}</div>
                </div>
                <div class="badge badge-due">Due</div>
              </div>
              {% endfor %}
            {% else %}
              <div class="muted text-sm">No upcoming deadlines</div>
            {% endif %}
          </div>
        </div>
        <!-- COURSE AVERAGES + UPCOMING -->
<section class="grid grid-cols-1 md:grid-cols-2 gap-4">
  <div class="glass p-4 lift">
    <h4 class="font-semibold mb-3">üìà Course Averages</h4>
    {% if chart_labels and chart_data %}
    <div class="space-y-3">
      {% for label, value in chart_labels|zip(chart_data) %}
      <div class="glass-soft p-3 flex items-center justify-between rounded-lg">
        <div class="font-medium">{{ label }}</div>
        <div class="text-right">
          <div class="font-bold text-blue-300">{{ value }}%</div>
          <div class="text-xs muted">Average</div>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="muted text-sm">No graded courses yet.</div>
    {% endif %}
  </div>

  <div class="glass p-4 lift">
    <h4 class="font-semibold mb-3">‚è∞ Upcoming</h4>
    <div class="space-y-3">
      {% set upcoming = assignments|selectattr('3','eq',None)|list %}
      {% if upcoming and upcoming|length > 0 %}
        {% for a in upcoming %}
        <div class="glass-soft p-3 rounded-lg flex items-center justify-between">
          <div>
            <div class="font-medium">{{ a[1] }}</div>
            <div class="text-xs muted">{{ a[2] }}</div>
          </div>
          <div class="badge badge-due">Due</div>
        </div>
        {% endfor %}
      {% else %}
        <div class="muted text-sm">No upcoming deadlines</div>
      {% endif %}
    </div>
  </div>
</section>

<!-- NOTIFICATIONS -->
<section class="glass p-4 lift">
  <div class="flex justify-between items-center mb-3">
    <div class="flex items-center gap-2">
      <h4 class="font-semibold">üîî Notifications</h4>
      {% if notifications %}
      <div class="text-xs badge badge-due">{{ notifications|length }} new</div>
      {% endif %}
    </div>

    {% if notifications %}
    <button id="studentNotifToggle"
            class="btn-subtle text-xs px-3 py-1 rounded-lg">
      Show Notifications
    </button>
    {% endif %}
  </div>

  {% if notifications %}
  <div id="studentNotifBody"
       class="max-h-0 overflow-hidden transition-all duration-300">
    <div class="space-y-3 max-h-64 overflow-y-auto custom-scroll pr-2 mt-2">
      {% for n in notifications %}
      <div class="glass-soft p-3 rounded-lg border-l-2 border-blue-500">
        <div class="text-sm">{{ n[0] }}</div>
        <div class="text-xs muted mt-1">{{ n[1] }}</div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% else %}
  <div class="muted text-sm">No new notifications.</div>
  {% endif %}
</section>

      </section>
<section class="glass p-4 lift">
  <div class="flex justify-between items-center mb-3">
    <div class="flex items-center gap-2">
      <h4 class="font-semibold">üîî Notifications</h4>
      {% if notifications %}
      <div class="text-xs badge badge-due">{{ notifications|length }} new</div>
      {% endif %}
    </div>

    {% if notifications %}
    <button id="studentNotifToggle"
            class="btn-subtle text-xs px-3 py-1 rounded-lg">
      Show Notifications
    </button>
    {% endif %}
  </div>

  {% if notifications %}
  <div id="studentNotifBody"
       class="max-h-0 overflow-hidden transition-all duration-300">
    <div class="space-y-3 max-h-64 overflow-y-auto custom-scroll pr-2 mt-2">
      {% for n in notifications %}
      <div class="glass-soft p-3 rounded-lg border-l-2 border-blue-500">
        <div class="text-sm">{{ n[0] }}</div>
        <div class="text-xs muted mt-1">{{ n[1] }}</div>
      </div>
      {% endfor %}
    </div>
  </div>
  {% else %}
  <div class="muted text-sm">No new notifications.</div>
  {% endif %}
</section>



        <div class="glass p-4 lift">
          <div class="flex justify-between items-center mb-3">
            <h4 class="font-semibold">üîî Notifications</h4>
            {% if notifications %}
            <div class="text-xs badge badge-due">{{ notifications|length }} new</div>
            {% endif %}
          </div>

    {% if notifications %}
    <div id="studentNotifBody"
         class="max-h-0 overflow-hidden transition-all duration-300">
      <div class="space-y-3 max-h-64 overflow-y-auto custom-scroll pr-2 mt-2">
        {% for n in notifications %}
        <div class="glass-soft p-3 rounded-lg border-l-2 border-blue-500">
          <div class="text-sm">{{ n[0] }}</div>
          <div class="text-xs muted mt-1">{{ n[1] }}</div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% else %}
    <div class="muted text-sm">No new notifications.</div>
    {% endif %}

        </div>
      </section>

      <!-- RECENT ACTIVITY -->
      <section class="glass p-4 lift">
        <h4 class="font-semibold mb-4">üìã Recent Activity</h4>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="glass-soft p-4 text-center rounded-lg">
            <div class="text-2xl mb-2">üìö</div>
            <div class="muted text-sm">Courses Active</div>
            <div class="font-bold text-white text-lg mt-1">{{ courses|length if courses else 0 }}</div>
          </div>

          <div class="glass-soft p-4 text-center rounded-lg">
            <div class="text-2xl mb-2">‚úÖ</div>
            <div class="muted text-sm">Completed</div>
            <div class="font-bold text-green-300 text-lg mt-1">{{ assignments|selectattr('4','ne',None)|list|length if assignments else 0 }}</div>
          </div>

          <div class="glass-soft p-4 text-center rounded-lg">
            <div class="text-2xl mb-2">‚è≥</div>
            <div class="muted text-sm">In Progress</div>
            <div class="font-bold text-yellow-300 text-lg mt-1">{{ assignments|selectattr('3','ne',None)|selectattr('4','eq',None)|list|length if assignments else 0 }}</div>
          </div>
        </div>
      </section>

      <footer class="text-center muted text-sm mt-2">¬© 2024 EduSync Portal ‚Ä¢ Optimized for Performance</footer>

    </main>
  </div>
</div>

<!-- SCRIPTS -->
<script>
  document.addEventListener('DOMContentLoaded', function(){
        // Student notifications collapse
    const studentNotifToggle = document.getElementById('studentNotifToggle');
    const studentNotifBody = document.getElementById('studentNotifBody');

    if (studentNotifToggle && studentNotifBody) {
      studentNotifToggle.addEventListener('click', () => {
        const isOpen = studentNotifBody.style.maxHeight && studentNotifBody.style.maxHeight !== '0px';

        if (isOpen) {
          studentNotifBody.style.maxHeight = '0';
          studentNotifToggle.textContent = 'Show Notifications';
        } else {
          studentNotifBody.style.maxHeight = studentNotifBody.scrollHeight + 'px';
          studentNotifToggle.textContent = 'Hide Notifications';
        }
      });
    }

    // Chart
    try {
      const labels = JSON.parse('{{ chart_labels | tojson | safe }}' || '[]');
      const data = JSON.parse('{{ chart_data | tojson | safe }}' || '[]');

      if (labels && labels.length && data && data.length) {
        const ctx = document.getElementById('gradeChart').getContext('2d');
        new Chart(ctx, {
          type: 'line',
          data: { labels: labels, datasets: [{ label: 'Scores', data: data, fill: false, borderColor: 'rgba(99,102,241,0.95)', tension: 0.35, borderWidth: 2, pointRadius: 3 }] },
          options: {
            responsive: true, maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
              y: { beginAtZero: true, max: 100, ticks: { color: '#9ca3af' }, grid: { color: 'rgba(255,255,255,0.03)' } },
              x: { ticks: { color: '#9ca3af' }, grid: { display: false } }
            },
            animation: { duration: 800 }
          }
        });
      }
    } catch (e) {
      console.error('Chart error', e);
    }

    // Assignment collapse (Option B)
    const assignToggle = document.getElementById('assignToggle');
    const assignBody = document.getElementById('assignBody');
    const assignIcon = document.getElementById('assignIcon');

    if (assignToggle && assignBody) {
      assignToggle.addEventListener('click', function(){
        const expanded = assignToggle.getAttribute('aria-expanded') === 'true';
        assignToggle.setAttribute('aria-expanded', (!expanded).toString());
        assignBody.setAttribute('aria-hidden', expanded ? 'true' : 'false');

        if (expanded) {
          // close
          assignBody.style.maxHeight = '0';
          assignBody.style.paddingTop = '0';
          assignBody.style.paddingBottom = '0';
          assignToggle.querySelector('span').textContent = 'Show Assignments';
          assignIcon.style.transform = '';
        } else {
          // open
          assignBody.style.paddingTop = '16px';
          assignBody.style.paddingBottom = '16px';
          assignBody.style.maxHeight = assignBody.scrollHeight + 'px';
          assignToggle.querySelector('span').textContent = 'Hide Assignments';
          assignIcon.style.transform = 'rotate(180deg)';
        }
      });

      // ensure collapsed on load
      assignBody.style.maxHeight = '0';
      assignBody.style.paddingTop = '0';
      assignBody.style.paddingBottom = '0';
    }

    // simple search debounce
    const searchInput = document.getElementById('globalSearch');
    if (searchInput) {
      let to;
      searchInput.addEventListener('input', (e) => {
        clearTimeout(to);
        to = setTimeout(()=> {
          // placeholder for search behavior
          // const q = e.target.value.trim().toLowerCase();
        }, 300);
      });
    }

    // small entrance animation for lift elements
    document.querySelectorAll('.lift').forEach((el, idx) => {
      el.style.opacity = '0';
      el.style.transform = 'translateY(6px)';
      setTimeout(()=> {
        el.style.transition = 'opacity .32s ease, transform .32s ease';
        el.style.opacity = '1';
        el.style.transform = 'translateY(0)';
      }, 80 * (idx+1));
    });

  });
</script>

{% endblock %}
